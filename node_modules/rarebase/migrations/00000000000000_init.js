exports.up = function(knex) {
  return knex.schema
  .createTable('tokens', (table) => {
    table.string("cid").notNullable()
    table.unique("cid")
    table.string("tokenId").primary().notNullable()
    table.string("name")
    table.text("description")
    table.text("image")
    table.text("uri").notNullable()
    table.string("type").notNullable()
    table.string("contract").notNullable()
    table.text("body").notNullable()
    table.bigInteger('created_at').defaultTo(Date.now())
    table.bigInteger('updated_at').defaultTo(Date.now())

    table.index('created_at', 'tokens_created_at_index')
    table.index('updated_at', 'tokens_updated_at_index')
    table.index('contract', 'tokens_conract_index')
    table.index('uri', 'tokens_uri_index')
    table.index('cid', 'tokens_cid_index')
  })
  .createTable("creators", (table) => {
    table.string('tokenId').references("tokenId").inTable("tokens")
    table.string("address").notNullable()
    table.boolean("signed").notNullable().defaultTo(false)

    table.index(['tokenId', 'address'], 'ownership_index');
  })
  .createTable("trades", (table) => {
    table.string("cid").notNullable()
    table.unique("cid")
    table.string('makeId').references("tokenId").inTable("tokens")
    table.string('takeId').references("tokenId").inTable("tokens")
    table.string("maker")
    table.string("taker")
    table.text("body").notNullable()
    table.bigInteger('created_at').defaultTo(Date.now())
    table.string("makeType").notNullable()
    table.string("takeType").notNullable()
    table.index('maker', 'trades_maker_index')
    table.index('taker', 'trades_taker_index')
    table.index('cid', 'trades_cid_index')
    table.index('created_at', 'trades_created_at_index')
    table.index(['makeType', 'takeType'], 'trades_make_take_type_index')
    table.index(['makeId', 'takeId'], 'make_take_tokenid_index');
  })
  // TODO createTable() for payouts and originFees
};
exports.down = function(knex) {
  return knex.schema
  .dropTable("creators")
  .dropTable("trades")
  .dropTable("tokens")
};

require('dotenv').config()
const Rarebase = require('../index')
const rarebase = new Rarebase();
(async () => {
  console.log("initialize")
  await rarebase.init({
    client: "postgresql",
    connection: {
      ssl: {
        rejectUnauthorized: false,
      },
      host: process.env.PG_HOST,
      port: parseInt(process.env.PG_PORT),
      user: process.env.PG_USER,
      password: process.env.PG_PASSWORD,
      database: process.env.PG_DATABASE
    }
  }).catch((e) => {
    console.log("Error", e)
  })
  console.log("initialized")
  const tokens = [
    {"@type":"ERC1155","tokenId":"3256456697922813437185651742328994256008601400993153196270314276605204338743","uri":"/ipfs/bafkreibb552qiw3czkrv6qokv5ddlnirhokihtfhnx6oos5syzxnegkesa","tokenURI":"/ipfs/bafkreibb552qiw3czkrv6qokv5ddlnirhokihtfhnx6oos5syzxnegkesa","contract":"0x1AF7A7555263F275433c6Bb0b8FdCD231F89B1D7","creators":[{"account":"0x73316d4224263496201c3420b36Cdda9c0249574","value":5000},{"account":"0xBb518628026D3E207e395a46c1b6F09aE9061C35","value":3000},{"account":"0x3eDac224bb7282f629A14FB4C481a394EFAe4669","value":2000}],"royalties":[],"signatures":["0xf85b64b6fcd96b76cc69026ec4ded56d37368992e43db5441e65cae4c2c7341b3e54294a6205047d561e546ad6589c0ec0b8f32c71e1c5afccb217acd6c0bfec1c","0x1099444746fa6d32ebe2b00f741d93219544b2b14ca6f7aa35d21fa95c0dfe4e6e91e63b8f9a8050140e8684e4763ac3c73b5cd20bb3cf58b1ca7046a6e302681c","0x2011e2ee2b821d0b0bf0482a4db9617bbdaeb255b255a76b66afc1267983fec93af1484e13442033f93692f7466d024f096a0b98f51c7c7dfbb544dca59a92d81c"],"supply":100,"metadata":{"name":"üçû","description":"bread","image":"/ipfs/bafkreie6cf5kgbrhjdbkqzztdxz36bizpakhsarzapnhzscdctbyo2ubza"},"_id":"uTDrXErB1Xt00j49"},
  {"@type":"ERC1155","tokenId":"52103307166765014994970427877263908096137622415890451140854055859263343130661","uri":"/ipfs/bafkreifwn36vmkf7dhc6yvaojpdkq4c7jdwtxrkudvyfntmrll6oe3wora","tokenURI":"/ipfs/bafkreifwn36vmkf7dhc6yvaojpdkq4c7jdwtxrkudvyfntmrll6oe3wora","contract":"0x1AF7A7555263F275433c6Bb0b8FdCD231F89B1D7","creators":[{"account":"0x73316d4224263496201c3420b36Cdda9c0249574","value":5000},{"account":"0xBb518628026D3E207e395a46c1b6F09aE9061C35","value":3000},{"account":"0x3eDac224bb7282f629A14FB4C481a394EFAe4669","value":2000}],"royalties":[],"signatures":["0x33ac347dd006a68e70a28039b2f1adf2e0746e631e82b9eeccc73e2b5f8a9d696bf8b47722fab275f516eb0ea81184828def354bd801cb88eac176b7c0ec84981b","0xe6f3b70ea2e8112c76dd135f3278e3b8597937e4383d81d896046361db3c12204cb96a823c9d9e8db50407fa0d035535c89c8f1537eac5c5f45eb39e052ad4281c","0x33d3124c8fb560d6c16aa3e5fdd5dfbf2233760fa8a0ab64f5f5e505f3599be53e42e0ae24cd4096a1b01cfc23106bea97e7a5aa137676f951089013699bee8b1c"],"supply":100,"metadata":{"name":"üçû","description":"bread","image":"/ipfs/bafkreiaigiavrtd6vcqdnmlxzfrdsgvnbvvwynl7t23t63353phsxwfo24"},"_id":"9nw7YbhVg2MecaLy"},
  ]
  for(let token of tokens) {
    await rarebase.token.save(token)
  }
  let queried = await rarebase.query.query({
    from: "creators",
    where: {
      tokenId: "52103307166765014994970427877263908096137622415890451140854055859263343130661"
    }
  })
  console.log("all users who own tokenId 521", queried)
  let usertokens= await rarebase.query.query({
    from: "creators",
    join: ["tokens", "creators.tokenId", "tokens.tokenId"],
    where: {
      "creators.address": "0xBb518628026D3E207e395a46c1b6F09aE9061C35".toLowerCase()
    }
  })
  console.log("all tokens owned by user 0xBb518628026D3E207e395a46c1b6F09aE9061C35", usertokens)



})();
